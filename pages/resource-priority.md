# 리소스 우선순위 (preload, prefetch, preconnect)

<br />

## preload

<br />

현재 페이지에서 사용될 것이 확실한 리소스들을 `preload`해서 가져옵니다. 가장 우선순위가 높습니다.

```html
<link rel="preload" as="script" href="super-important.js">
<link rel="preload" as="style" href="critical.css">
```
> **[주의사항]**  
> **as 속성을 사용한다.** | 리소스의 유형을 브라우저에게 알려줘야합니다.  
> **중복 리소스를 참조** | 중복 참조 시 중복된 갯수만큼 리소스를 가져오므로, 중복되지 않도록 참조합니다.
> **반드시 사용되는 리소스에만 사용** | 3초 내로 사용되지 않는 경우에는 warning이 콘솔 메시지로 출력됩니다.

## preconnect

<br />

현재 페이지에서 외부 도메인의 리소스를 참고하는 것을 브라우저에게 알려 외부 도메인과 연결을 설정할 수 있도록 합니다.
`preconnect`를 사용하면 브라우저가 사이트에 필요한 연결을 미리 예상할 수 있게 됩니다. 필요한 소켓을 미리 설정할 수 있기 때문에 DNS, TCP, TLS 등에 필요한 시간 절약을 돕습니다.

```html
<link rel="preconnect" href="https://example.com">
```
> **[주의사항]**  
> **CPU 시간 차지** | 외부 도메인과 연결을 구축하기 때문에 10초 이내로 닫히는 페이지라면 preconnect를 사용하지 않는 것이 좋습니다.

**[preconnect 사용하기 좋은 상황]**

1. 정확한 경로를 알 수 없는 경우
   * 주어진 CDN으로부터 리소스를 가져와야한다는 것은 알지만, 경로를 모르는 경우가 있습니다. 
   * (브라우저 별로 가져와야하는 리소스 버전이 다른 경우에 사용하는 경우 등)
   * 리소스를 가져오지 않아도 미리 서버에 연결하여 최적화할 수 있습니다.
2. 미디어 스트리밍
   * 스크립트가 로드되고 스트리밍 처리가 될 때까지 스트리밍을 기다릴 경우,
   * 대기 시간을 줄일 수 있습니다.

## prefetch

<br />

미래에 사용될 것으로 예상되는 리소스들을 `prefetch`합니다.  
사용자가 다음에 할 행동을 미리 준비하는데 적합한 기능입니다. 결과 목록에서 첫 번째 제품 페이지를 가져오거나 다음 컨텐츠 페이지를 가져오는 것 등을 처리할 때 유용합니다.

```html
<link rel="prefetch" href="page-2.html">
```
> **[주의사항]**  
> **재귀적으로 동작하지 않는다.** | 호출 시 html 리소스만 가져옵니다. 해당 파일에서 사용되는 CSS, JS 등의 리소스들은 가져오지 않습니다.  
> **Override 목적으로 사용하지 않는다.**

```html
<html>
<head>
    <link rel="prefetch" href="optional.css">
    <link rel="stylesheet" href="optional.css">
</head>
<body>
Hello!
</body>
</html>
```

위의 경우와 같이 두 번 정의되는 경우에는, 한 번은 높은 순위로, 한 번은 낮은 순위로 스타일을 2번 가져오게 됩니다.  
기본적으로 렌더링 차단 요소인 CSS를 기다리기도 해야하고 두 번이나 다운로드 되기 때문에 동일 리소스를 여러번 가져오는 경우는 피하는 것이 좋습니다.
